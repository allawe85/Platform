@page "/login"
@using Platform.Blazor.Services.Auth
@using Microsoft.Extensions.Localization
@using Platform.Blazor.Resources
@layout Platform.Blazor.Layout.LoginLayout
@inject IAuthService Auth
@inject NavigationManager Nav
@inject IStringLocalizer<AppStrings> Loc

<MudGrid Justify="Justify.Center" Class="mt-10">
    <MudItem xs="12" sm="8" md="4">
        <MudCard Elevation="4" Class="pa-4">
            <MudCardHeader>
                <CardHeaderContent>
                     <div class="d-flex justify-center mb-4">
                        <MudImage Src="images/logo-moi.svg" Alt="Logo" Height="120" />
                    </div>
                    <MudText Typo="Typo.h5" Align="Align.Center" Color="Color.Primary" Class="mb-4">@Loc["Login"]</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTextField @bind-Value="Model.UserNameOrEmail" Label="@Loc["UsernameOrEmail"]" Variant="Variant.Outlined" Class="mb-4" />
                <MudTextField @bind-Value="Model.Password" Label="@Loc["Password"]" InputType="InputType.Password" Variant="Variant.Outlined" />
            </MudCardContent>
            <MudCardActions Class="d-flex flex-column gap-2 mt-4 ml-2 mr-2">
                <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="DoLogin" Class="py-2">@Loc["Login"]</MudButton>
                <MudButton ButtonType="ButtonType.Button" Variant="Variant.Text" Color="Color.Secondary" FullWidth="true" Href="/register">@Loc["Register"]</MudButton>
            </MudCardActions>
        </MudCard>
        @if (!string.IsNullOrEmpty(Error))
        {
            <MudAlert Severity="Severity.Error" Class="mt-4">@Error</MudAlert>
        }
    </MudItem>
</MudGrid>

@code {
    LoginRequest Model = new("", "");
    string? Error;

    async Task DoLogin()
    {
        Error = null;
        var token = await Auth.LoginAsync(Model);
        if (token != null)
        {
            Nav.NavigateTo("/employee-home", forceLoad: true);
        }
        else
        {
            Error = Loc["LoginFailed"];
        }
    }
}
