@page "/register"
@layout Platform.Blazor.Layout.LoginLayout
@inject IAuthService Auth
@inject NavigationManager Nav

<MudGrid Justify="Justify.Center" Class="mt-10">
    <MudItem xs="12" sm="8" md="4">
        <MudCard>
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h5" Align="Align.Center">Register</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTextField @bind-Value="Model.UserName" Label="Username" Variant="Variant.Outlined" Class="mb-3" />
                <MudTextField @bind-Value="Model.Email" Label="Email" InputType="InputType.Email" Variant="Variant.Outlined" Class="mb-3" />
                <MudTextField @bind-Value="Model.Password" Label="Password" InputType="InputType.Password" Variant="Variant.Outlined" />
            </MudCardContent>
            <MudCardActions>
                <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="DoRegister" Class="mb-3">Register</MudButton>
                <MudButton ButtonType="ButtonType.Button" Variant="Variant.Text" Color="Color.Secondary" FullWidth="true" Href="/login">Back to Login</MudButton>
            </MudCardActions>
        </MudCard>
        @if (!string.IsNullOrEmpty(Error))
        {
            <MudAlert Severity="Severity.Error" Class="mt-2">@Error</MudAlert>
        }
    </MudItem>
</MudGrid>

@code {
    RegisterRequest Model = new("", "", "");
    string? Error;

    async Task DoRegister()
    {
        Error = null;
        var result = await Auth.RegisterAsync(Model);
        if (result.Successful)
        {
            Nav.NavigateTo("/login");
        }
        else
        {
            Error = string.Join("\n", result.Errors);
        }
    }
}
